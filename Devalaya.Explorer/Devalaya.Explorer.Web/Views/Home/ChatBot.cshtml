@model dynamic

@{
    ViewData["Title"] = "Chatbot";
    Layout = "_Layout";
}

<!-- Bootstrap CSS and Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<div class="container d-flex justify-content-around align-items-center min-vh-100 bg-white border-black">
    <div class="card p-4" style="width: 600px; max-height: 100vh; overflow: hidden;">
        <h2 class="mb-2 text-center text-primary">==Devalaya ChatBot==</h2>
        <p class="text-center mb-2">I’m here to help.Chat or Explore!</p>

        <div class="chat-area bg-light p-3 mb-3 overflow-auto" style="height: 300px;" id="outputBox">
           
        </div>

        <div class="input-group">
            <input type="text" id="inputBox" class="form-control border-primary" placeholder="Your message" />
            <button type="button" class="btn btn-primary-px-3 border-primary" onclick="sendMessage()">
                <i class="bi bi-send"></i> 
            </button>
        </div>

        <div class="d-flex gap-2 mb-2">
            <input type="file" id="fileUpload" class="form-control" accept=".txt,.pdf,.jpg,.png" />
        </div>

       
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
<script>
        var connection = new signalR.HubConnectionBuilder()
        .withUrl("/ollamaHub")
        .build();

       
            connection.on("ReceiveOllamaResponse", function (message) {
        document.getElementById("outputBox").innerText += message;
    });



        connection.start().then(() => {
        console.log("Connected to SignalR");
    });

        function sendMessage() {
        const inputBox = document.getElementById('inputBox');
        const message = inputBox.value.trim();
        const outputBox = document.getElementById('outputBox');
        const time = new Date().toLocaleTimeString();

        if (message) {
            outputBox.innerHTML += `<div class="mb-1"><strong>You:</strong> ${message} </div>`;
            scrollToBottom();

            
            connection.invoke("SendOllamaRequest", message).catch(err => console.error(err.toString()));

            inputBox.value = '';
        }
    }

    function scrollToBottom() {
        const outputBox = document.getElementById('outputBox');
        outputBox.scrollTop = outputBox.scrollHeight;
    }

</script>

